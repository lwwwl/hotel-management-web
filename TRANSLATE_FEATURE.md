# 消息自动翻译功能

## 功能概述

在酒店客服系统的聊天页面中新增了消息自动翻译功能，支持中文、英文、日文三种语言的实时翻译。

## 功能特性

### 1. 翻译开关
- 位于聊天区域顶部，提供直观的开关控制
- 支持开启/关闭翻译功能
- 当没有选中会话时，开关处于禁用状态

### 2. 语言选择
- 支持三种语言：中文（zh_CN）、英文（en_US）、日文（ja_JP）
- 提供国旗图标和语言名称的直观选择界面
- 语言切换时自动重新翻译当前会话的所有消息

### 3. 消息翻译显示
- 翻译结果显示在原始消息下方
- 使用分隔线区分原文和翻译
- 支持加载状态和错误状态显示
- 翻译结果包含在同一个消息气泡内

### 4. 实时翻译
- 新接收的消息自动进行翻译（如果翻译功能已开启）
- 历史消息在开启翻译时批量翻译
- 支持翻译状态管理，避免重复请求

## 技术实现

### 组件结构
```
ChatMain
├── TranslateSwitch (翻译开关组件)
└── ChatMessages (消息显示组件)
    └── 消息气泡
        ├── 原始消息内容
        └── 翻译结果区域
            ├── 加载状态
            ├── 错误状态
            └── 翻译内容
```

### 核心文件
- `src/features/chat/TranslateSwitch.tsx` - 翻译开关组件
- `src/services/translateService.ts` - 翻译服务
- `src/hooks/useChats.ts` - 翻译逻辑集成
- `src/features/chat/ChatMessages.tsx` - 消息显示更新
- `src/types/index.ts` - 类型定义

### API接口
- 接口地址：`/translate/get-translate-result`
- 请求方法：POST
- 请求参数：
  ```typescript
  {
    conversationId: number;
    messageIdList: number[];
    language: 'zh_CN' | 'en_US' | 'ja_JP';
  }
  ```

## 使用方法

1. **开启翻译功能**
   - 在聊天页面顶部找到翻译开关
   - 点击开关按钮开启翻译功能

2. **选择目标语言**
   - 开启翻译后，点击语言选择器
   - 从下拉菜单中选择目标语言

3. **查看翻译结果**
   - 翻译结果会显示在每条消息的下方
   - 加载中时显示旋转图标和"翻译中..."文字
   - 翻译失败时显示"翻译失败"提示

## 状态管理

### 消息翻译状态
- `translation`: 翻译结果内容
- `translationLoading`: 翻译加载状态
- `translationError`: 翻译错误状态

### 全局翻译状态
- `translateEnabled`: 翻译功能开关状态
- `selectedLanguage`: 当前选择的翻译语言
- `translatingMessages`: 正在翻译的消息ID集合

## 注意事项

1. **性能优化**
   - 避免重复翻译同一条消息
   - 使用Set管理翻译中的消息ID
   - 批量翻译历史消息，单条翻译新消息

2. **错误处理**
   - 网络错误时显示友好提示
   - 翻译失败不影响正常聊天功能
   - 自动重试机制（可扩展）

3. **用户体验**
   - 翻译开关状态持久化（可扩展）
   - 语言选择记忆功能（可扩展）
   - 翻译结果缓存（可扩展）

## 扩展功能

未来可以考虑添加的功能：
- 翻译结果缓存
- 翻译历史记录
- 更多语言支持
- 翻译质量评分
- 自定义翻译引擎
